---
title: 怎么写更好懂的代码
date: "2020-04-12 02:13:15"
description: "《编写可读代码的艺术》阅读笔记"
---

### 前言

前段时间在多抓鱼上凑包邮买了一本书 —— [《编写可读代码的艺术》](https://book.douban.com/subject/10797189)。

原本是当睡前读物看。结果越看越有意思，虽说书有一点老，讲的技巧之前多多少少也在别的地方看过，但还是有不少启发。以下是读书笔记ww

---

### 第一章 代码应当易于理解

关键思想: 代码的写法应当使别人理解它所需的时间最小化

### 第二章 把信息装到名字里

* 读者仅通过读到名字就可以获得大量信息

* 更多提示：

  1. 使用专业的单词 —— 例如不用 Get，而用 Fetch 或者 Download
  2. 避免空泛的名字
  3. 使用具体的名字来更细致地描述事物 —— 例如 CanListenOnPort 就比 ServerCanStart 更清楚
  4. 给变量名带上重要的细节 —— 例如可以带上单位
  5. 为作用域大的名字采用更长的名字
  6. 有目的地使用大小写、下划线等 —— 例如可以用下划线区分类成员和局部变量

### 第三章 不会误解的名字

1. 不会误解的名字是最好的名字
2. 定义一个值的上限或下限时，可以用 max- 和 min-。对于范围类，first-，last-，begin- 和 end- 都可以酌情使用
3. 当为布尔值命名时，可以使用 is 或 has 这样的词来使其更明确，避免使用反义词，如 disable_ssl
4. 小心用户对特定词的期望。例如，用户会期望 get() 或 size() 是轻量的方法

**个人补充：**

为布尔值命名这里，个人认为除了上述形式，在使用形容词或被动时，不需要加上 is / has，例如 inventoryEnough，clicked。本身就能顾名思义

### 第四章 审美

* 好的源代码应当 “看上去养眼”，确切地说，有三条原则：

  1. 使用一致的布局，让读者习惯这种风格
  2. 让相似的代码看上去相似
  3. 把相关的代码分组，形成代码块

* 一些具体技巧：

  1. 若多个代码块做相似的事情，尝试让它们有同样的剪影
  2. 把代码按 “列” 对齐，让它更容易浏览
  3. 选择一个有意义的顺序，并始终用这样的顺序。例如在一段代码中提到 A、B 和 C，那么就不要在另一段中说 B、C 和 A
  4. 用空行来把大块代码分成逻辑上的 “段落”

* 一致的风格比 “正确” 的风格更重要

**个人补充：**

在进入上一家公司前。我写 JS 缩进 4 格，不写分号。写 CSS 时各种选择器都会使用。而公司代码风格是 2 格缩进，必加分号。CSS 也要遵循 BEM 的规则。一开始着实好一阵不习惯，但慢慢就发现，风格没有对错，对团队来说，重要的是统一。

后来自己还去查了一些大厂的 CSS 书写规范建议，的确会更清晰：

* Airbnb：[A mostly reasonable approach to CSS and Sass.](https://github.com/airbnb/css)
* 腾讯： [Code Guide by @AlloyTeam](http://alloyteam.github.io/CodeGuide/#css-declaration-order)
* 百度： [fex-team/styleguide](https://github.com/fex-team/styleguide/blob/master/css.md#33-%E5%B1%9E%E6%80%A7%E4%B9%A6%E5%86%99%E9%A1%BA%E5%BA%8F)

### 第五章 该写什么样的注释

* 不需要注释的地方：

  1. 能从代码本身迅速推断出的事实
  2. 用来粉饰烂代码（例如蹩脚的函数名）的 “拐杖式注释” —— 应该做的是把代码改好

* 自己应该记录下来的想法包括：

  1. 为什么代码写成这样而不是那样的内在理由（“指导性批注”）
  2. 代码中的缺陷，使用像是 TODO 这样的标记
  3. 常量背后的故事，为什么是这个值

* 从读者立场思考需要注释的部分：

  1. 预料到会让读者困惑的部分
  2. 普通读者意料之外的部分
  3. 在文件 / 类的级别上使用 “全局观” 注释来解释所有的部分是如何一起工作的
  4. 用注释来总结代码块，使读者不会迷失在细节中

### 第六章 写出言简意赅的注释

* 具体指示：

  1. 避免使用 “it” 或 “this” 等可能指代多个事物的代词
  2. 尽量精准描述函数的行为
  3. 在注释中用精心挑选的输入 / 输出示例来说明
  4. 声明代码的高层次意图，而非明显的细节
  5. 用嵌入的注释来理解难以理解的函数参数
  6. 用含义丰富的词来使注释简洁

**个人补充：**

关于函数，好的测试用例就是最好的注释

### 第七章 把控制流变得易读

* 让代码的控制流更易读的几种方法：

  1. 在写比较条件时，把改变的值写在左边，把稳定的值（例如常数）写在右边
  2. 可以重新排列 if / else 里的语句块。通常来说，先处理正确的 / 简单的 / 有趣的情况。有时准则会有冲突，当不冲突时，就遵循这些经验法则
  3. 某些编程结构，像三元运算符、do / while 循环等会导致代码的可读性变差，最好不要使用
  4. 尽量写更加 “线性” 的代码，避免深嵌套
  5. 通常来讲，提早返回可以减少嵌套并让代码整洁

### 第八章 拆分超长的表达式

* 拆分巨大表达式的方法：

  1. 引入 “解释变量”。可以用简单的名字描述子表达式，帮助读者识别代码中的主要概念，也让代码文档化
  2. 利用德摩根定理来操作逻辑表达式，将布尔表达式用更简洁的方式重写

**个人补充：**

使用反向思考的方式的确能使代码更易读且更简练

### 第九章 变量与可读性

* 通过减少变量的数量和让它们尽量 “轻量级” 来让代码更有可读性：

  1. 减少变量，尤其是 “中间结果” 型变量
  2. 减小每个变量的作用域
  3. 只写一次的变量最好。只设置一次值的变量使得代码更好理解

### 第十章 抽取不相关的子问题

* 所谓工程学，就是关于把大问题拆分成小问题再把这些问题的解决方案放回一起。把这条原则应用于代码会使代码更健壮并且更容易读

* 建议：**积极地发现并抽取出不相关的子逻辑**：

  1. 看看某个函数或代码块，自问：这段代码高层次目标是什么？
  2. 对于每一行代码，自问：它是直接为目标工作吗？这段代码高层次目标是什么？
  3. 如果足够的行数在解决不相关的子问题，抽取代码到独立函数中

* 推荐阅读：
  《Refactoring: Improving the Design of Existing code》
  《Smalltalk Best Practice Patterns》

**个人补充：**

这种自上而下式的代码抽象组织形式，在使用时可以装上 vs code 上一个叫 [CodeMetrics](https://marketplace.visualstudio.com/items?itemName=kisstkondoros.vscode-codemetrics) 的插件来辅助

### 第十一章 一次只做一件事

如果你有很难读的代码，尝试把它所做的所有任务列出来。其中一些任务可以很容易地变成单独的函数（或类）。其他的可以简单成为一个函数中的逻辑 “段落”

### 第十二章 把想法变成代码

* 编写精炼代码的一部分工作是了解你的库提供了什么

* 用自然语言描述程序，然后用这个描述来帮助你写出更自然的代码。即 “小黄鸭编程法”

### 第十三章 少写代码

* 通过重用库或者减少功能，你可以节省时间并且让你的代码库保持精简节约

* 每隔一段时间，花15分钟来阅读标准库中的所有函数 / 模块 / 类型的名字

* 每行新代码都要测试、写文档和维护。同时，代码库中的代码越多，它就越重，而且在其上开发就越难。

* 可以通过以下方法避免写新代码：

  1. 从项目中消除不必要的功能，不要过度设计
  2. 重新考虑需求，解决版本最简单的问题，只要能完成工作就行
  3. 经常性地通读标准库的整个API，保持对它们的熟悉程度

### 第十四章 测试与可读性

* 改进测试的几个具体要点：

  1. 每个测试的最高一层应该越简明越好。最好每个测试的输入 / 输出可以用一行代码来描述
  2. 如果测试失败了，它所发出的错误消息应该能让你容易跟踪并修正这个 bug
  3. 使用最简单的并且能完整运用代码的测试输入
  4. 给测试函数取一个有完整描述性的名字，以使每个测试所测到的东西很明确
  5. 使测试都易于改动和增加新的测试

### 深入阅读推荐

* 《代码大全》
* 《重构》
* 《程序设计实践》
* 《程序员修炼之道》
* 《代码整洁之道》
